---
# checks.yml

- name: Gather minimal facts (non blocking)
  ansible.builtin.setup:
    gather_subset:
      - min
  register: setup_result
  failed_when: false
  when: ansible_facts is not defined or ansible_facts == {}

- name: Skip host if facts are unavailable
  ansible.builtin.meta: end_host
  when: ansible_facts.get('distribution', '') == ''

# Stop if not RedHat
- name: Stop role if OS is not RedHat
  ansible.builtin.meta: end_host
  when: (ansible_facts.get('distribution', '') | lower) != 'redhat'

# Stop if OS version < 7
- name: Stop role if OS version is not supported
  ansible.builtin.meta: end_host
  when: (ansible_facts.get('distribution_major_version', '0') | int) < 7